<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Garbage collection in Python" /><meta property="og:locale" content="en" /><meta name="description" content="When it comes to memory management, the vital task of any developer is taking care of a memory requirements of given program. This assumes allocating and dislocating the memory occupied by the variables and their data. In the early days of programming, it was a manual task so developer solely was responsible for the memory management. It was laborious job, because every single variable needed to be traced from the declaration/assignation to the point where it may be no longer needed in the code. This meant tracing variables’ attributes like scope, life and their interaction within the code, which all needed to be taken into consideration when removing it from the memory. The bugs occurred often and were sometimes hard to trace. This still stands for major languages like C/C++, although there are some add-ins that offer user-configurable memory management techniques." /><meta property="og:description" content="When it comes to memory management, the vital task of any developer is taking care of a memory requirements of given program. This assumes allocating and dislocating the memory occupied by the variables and their data. In the early days of programming, it was a manual task so developer solely was responsible for the memory management. It was laborious job, because every single variable needed to be traced from the declaration/assignation to the point where it may be no longer needed in the code. This meant tracing variables’ attributes like scope, life and their interaction within the code, which all needed to be taken into consideration when removing it from the memory. The bugs occurred often and were sometimes hard to trace. This still stands for major languages like C/C++, although there are some add-ins that offer user-configurable memory management techniques." /><link rel="canonical" href="https://sbozich.github.io/posts/garbage-collection-python/" /><meta property="og:url" content="https://sbozich.github.io/posts/garbage-collection-python/" /><meta property="og:site_name" content="sbozich" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-03T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Garbage collection in Python" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-08-03T00:00:00+02:00","datePublished":"2022-08-03T00:00:00+02:00","description":"When it comes to memory management, the vital task of any developer is taking care of a memory requirements of given program. This assumes allocating and dislocating the memory occupied by the variables and their data. In the early days of programming, it was a manual task so developer solely was responsible for the memory management. It was laborious job, because every single variable needed to be traced from the declaration/assignation to the point where it may be no longer needed in the code. This meant tracing variables’ attributes like scope, life and their interaction within the code, which all needed to be taken into consideration when removing it from the memory. The bugs occurred often and were sometimes hard to trace. This still stands for major languages like C/C++, although there are some add-ins that offer user-configurable memory management techniques.","headline":"Garbage collection in Python","mainEntityOfPage":{"@type":"WebPage","@id":"https://sbozich.github.io/posts/garbage-collection-python/"},"url":"https://sbozich.github.io/posts/garbage-collection-python/"}</script><title>Garbage collection in Python | sbozich</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="sbozich"><meta name="application-name" content="sbozich"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/92573419?s=400&u=b8588cad17faefe915dd88072a9fdd03b516d081&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">sbozich</a></div><div class="site-subtitle font-italic">Bits&pieces about tech</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/sbozich" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['newbraveworld','zohomail.eu'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Garbage collection in Python</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Garbage collection in Python</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1659477600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 3, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/sbozich">Sinisa Bozic</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1713 words"> <em>9 min</em> read</span></div></div></div><div class="post-content"><p>When it comes to memory management, the vital task of any developer is taking care of a memory requirements of given program. This assumes allocating and dislocating the memory occupied by the variables and their data. In the early days of programming, it was a manual task so developer solely was responsible for the memory management. It was laborious job, because every single variable needed to be traced from the declaration/assignation to the point where it may be no longer needed in the code. This meant tracing variables’ attributes like scope, life and their interaction within the code, which all needed to be taken into consideration when removing it from the memory. The bugs occurred often and were sometimes hard to trace. This still stands for major languages like C/C++, although there are some add-ins that offer user-configurable memory management techniques.</p><p>Garbage collection stands for an automatized memory reclaiming process and it is a standard feature (rather than optional add-in) in the high-level languages developed in the last 30 years. This feature relieves the developer from the manual work and applies one or more algorithms, which run automatically, independently from the user. Garbage collector identifies previously allocated memory spaces (therefore called garbage) which are no more referenced by the program’s variables, and removes them, thus freeing memory.</p><h2 id="pythons-garbage-collector-specifications"><span class="mr-2">Python’s garbage collector specifications</span><a href="#pythons-garbage-collector-specifications" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Python documentation <a href="https://docs.python.org/3/glossary.html#term-garbage-collection" target="_blank">states</a> following:</p><p><i>Garbage collection: The process of freeing memory when it is not used anymore. Python performs garbage collection via reference counting and a cyclic garbage collector that is able to detect and break reference cycles. The garbage collector can be controlled using the gc module.</i></p><p>From the upper definition we can see that the garbage collection in Python is twofold:</p><ol><li>Reference counting algorithm takes care of number of references that each object through its life gets. It is an integral part of the Python, it is automatic, constant process running in the background and it can’t be managed from the user side.<li>Cyclic garbage collector was added later up, when it was realized that the reference counting algorithm can’t detect some referencing cases such as reference cycles, where either object references itself or more objects are referencing each other. This garbage collector can be directly manipulated, it runs automatically periodically (but not constantly) in the background, and it can be manually switched off.</ol><h2 id="reference-counting"><span class="mr-2">Reference counting</span><a href="#reference-counting" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Python is structured in a such way that it does not “hold” any data in variables but rather use them just as names which reference to the actual objects that reserve or allocate actual memory space. Every object has a header field that records actual number of references to it. For the details about this model, see following texts:</p><p><a href="https://sbozich.github.io/posts/dynamic-typing-pt1/" target="_blank">The joys of Dynamic Typing, Part One - Immutables</a></p><p><a href="https://sbozich.github.io/posts/dynamic-typing-pt2/" target="_blank">The joys of Dynamic Typing, Part Two - Mutables</a></p><p>What reference counting algorithm does is deallocates objects which loose references to the variables (more precisely, when reference count equals zero).</p><p>Consider following code:</p><h3 id="example-1"><span class="mr-2">Example 1.</span><a href="#example-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s">'price'</span><span class="p">:</span> <span class="s">'GBP'</span><span class="p">,</span> <span class="s">'quantity'</span><span class="p">:</span> <span class="s">'pounds'</span><span class="p">}</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="s">'price'</span><span class="p">:</span> <span class="s">'GBP'</span><span class="p">,</span> <span class="s">'quantity'</span><span class="p">:</span> <span class="s">'pounds'</span><span class="p">}</span>

<span class="k">print</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span> <span class="c1"># True
</span><span class="k">print</span><span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># False
</span>
<span class="k">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># 2295298897536
</span><span class="k">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="c1"># 2295298897792
</span></pre></table></code></div></div><p>We created two dictionaries with the same values. Equality check expectedly returns True, because the values are the same. Identity check however prints out False, which tells us that the objects behind those two dictionaries are not the same, which is confirmed if we print out their memory addresses via id() function. Now if we display reference count of those dictionaries, we get following:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># 2
</span><span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="c1"># 2
</span></pre></table></code></div></div><p>Number of references is 2 for each object, respectively. One reference is created on assignation, another reference is created by getrefcount() function itself.</p><h3 id="example-2"><span class="mr-2">Example 2.</span><a href="#example-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">sys</span>

<span class="nb">list</span><span class="o">=</span><span class="p">[]</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">func</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span> <span class="c1"># returns 4
</span>
<span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="nb">list</span><span class="p">))</span> <span class="c1"># returns 2
</span></pre></table></code></div></div><p>We created an empty list and defined a function which returns number of references for the passed argument. When we call the function and pass our empty list, the returned count of references is, maybe surprisingly, four:</p><ul><li>one reference for assignation of list,<li>one reference for passing an argument,<li>one reference for using function itself,<li>one reference for getrefcount() function</ul><p>On the other side, the reference count for the list itself is two:</p><ul><li>one reference for assignment,<li>one reference for getrefcount() function.</ul><h3 id="example-3"><span class="mr-2">Example 3.</span><a href="#example-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">sys</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># 2
</span><span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># 3
</span></pre></table></code></div></div><p>By assigning an object to another object the reference count increases. To sum it up, there are four ways to increase the reference count:</p><ul><li>assignment operator,<li>argument passing,<li>calling a function or class,<li>inserting an object to another object.</ul><p>The reference count decreases when applying opposite concepts:</p><ul><li>reassigning the variable to another object,<li>deleting the variable,<li>exiting the function or class instance (Python destroys references with the variable scope local to that code block),<li>deleting an object within another object.</ul><p>There are some things to be considered though. The variable’s scope is important. If the variable has the local scope (for example, lives only in the function or class), then on exiting from the code block, Python destroys variables with local scope and thus lowers the reference count of their objects in background. Objects are destroyed only when their reference count reaches zero, not on the decrementation of the reference count! The reference count decrementation of one object that is linked to other objects is mutually linked, so when complex object like list or dictionary (containing another objects) is deleted, the reference count for all containing objects is decremented as well. If, however, another object links one or more previously deleted objects, the interpreter will take that into account and update the current reference count of such objects.</p><p>Variables outside of function/class scope that reside in the program’s “root” are global variables. Their reference count is shielded from the garbage collector as they are stored inside a dictionary and live until the termination of Python’s interpreter. The user can display global variables’ dictionary by using function globals().</p><h2 id="cyclic-garbage-collector"><span class="mr-2">Cyclic garbage collector</span><a href="#cyclic-garbage-collector" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>A reference counting algorithm has one major drawback: it can’t handle reference cycles. If one variable references itself, or two or more objects are referencing each other, such situation is called a cyclic or circular reference. The reference counts stemming from cyclic references can’t be detected using reference counting algorithm, hence, additional garbage collector’s algorithm is needed to detect those and to remove them from the memory space.</p><p>If we assign a variable to itself and delete it afterwards, we can’t access the reference count as the variable is deleted:</p><h3 id="example-4"><span class="mr-2">Example 4.</span><a href="#example-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">x</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># reference count=3
</span><span class="k">del</span> <span class="n">x</span>
</pre></table></code></div></div><p>Since variable x is deleted, we can’t access it using the getrefcount() function to determine what actually happened after deleting and what is the count of its references. Therefore, we must dig deeper and use code that can access memory address of the deleted object directly. In order to justify usage of another garbage collection algorithm, we need to prove that the reference count algorithm does not detect cyclic references.</p><p>Consider following situation depicted below.</p><h3 id="example-5"><span class="mr-2">Example 5.</span><a href="#example-5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">import</span> <span class="nn">ctypes</span>

<span class="k">class</span> <span class="nc">PyObject</span><span class="p">(</span><span class="n">ctypes</span><span class="p">.</span><span class="n">Structure</span><span class="p">):</span>
    <span class="n">_fields_</span><span class="o">=</span><span class="p">[(</span><span class="s">"refcount"</span><span class="p">,</span> <span class="n">ctypes</span><span class="p">.</span><span class="n">c_long</span><span class="p">)]</span>

<span class="n">gc</span><span class="p">.</span><span class="n">disable</span><span class="p">()</span> <span class="s">""" disable garbage collector to demonstrate that reference remains although we deleted variable"""</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">x</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># x references itself
</span><span class="k">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># reference count=3
</span>
<span class="n">x_address</span><span class="o">=</span><span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">del</span> <span class="n">x</span>

<span class="k">print</span><span class="p">(</span><span class="n">PyObject</span><span class="p">.</span><span class="n">from_address</span><span class="p">(</span><span class="n">x_address</span><span class="p">).</span><span class="n">refcount</span><span class="p">)</span> <span class="s">""" reference count=1"""</span>

<span class="n">gc</span><span class="p">.</span><span class="n">collect</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">PyObject</span><span class="p">.</span><span class="n">from_address</span><span class="p">(</span><span class="n">x_address</span><span class="p">).</span><span class="n">refcount</span><span class="p">)</span> <span class="s">""" reference count=0 """</span>
</pre></table></code></div></div><p>In this example we used <a href="https://docs.python.org/3/library/ctypes.html" target="_blank">ctypes</a>, a foreign function library which enables using C data types which we will need since we’ll going to access memory addresses directly. The default cyclic garbage collector was disabled, to prevent it from eventual cleaning of the reference counts. Then we assign a memory address of variable x to another variable. Afterwards, we delete the x and print out the reference count of the object that we accessed through its memory address. Since we get one reference returned following is obvious:</p><ul><li>it is a proof that object still exists, regardless of the prior deletion of the variable x,<li>it is a proof that reference count garbage collector hasn’t detected the cyclic reference.</ul><p>When we manually start the cyclic garbage collector, we demonstrate that it works as it should because now the reference count that is returned equals zero.</p><p>As previously noted, the cyclic garbage collector runs automatically but not constantly opposed to the reference count collector, it activates itself occasionally. Another difference is that it is completely manageable and configurable, as it can be accessed within the code by using the gc module. Basically, what cyclic garbage collector does is detection of cyclic references and creation of three generations of variables which have different conditions (thresholds). We won’t go deeper in this matter here, rather we will provide some insights of how useful the understanding of the garbage collection could be.</p><h2 id="usage-tips"><span class="mr-2">Usage tips</span><a href="#usage-tips" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Broadly speaking, it is best leaving all as it is, because the garbage collectors certainly justified their existence through evolutionary, incremental advancement steps during the couple of decades. They apply advanced algorithms which, on average, do satisfying job within the specified parameters. Yet, on some specific cases it is possible to tune the Python’s cyclic garbage collector, or to disable it altogether. Sometimes is favorable to avoid cyclic references completely, by using <a href="https://docs.python.org/3/library/weakref.html" target="_blank">weak references</a> instead. Another tip worth mentioning is to take a look on the global variables in the program’s code as they are untouched by the reference counting. As always, understanding the logic behind the garbage collector reveals a lot about Python’s internals and can help you to better understand the involved processes, ultimately envisioning better code for your needs.</p><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This article touches upon the memory management in Python; its automation and garbage collection process. We explained the reasons behind the both implementations of garbage collector in Python, together with valid examples. Additionally, we proved why there is a need for second garbage collector, and finally gave some tips worth considering when designing your code.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/python/'>python</a>, <a href='/categories/garbage-collection/'>garbage collection</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/python/" class="post-tag no-text-decoration" >python</a> <a href="/tags/garbage-collection/" class="post-tag no-text-decoration" >garbage collection</a> <a href="/tags/reference-counting/" class="post-tag no-text-decoration" >reference counting</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Garbage+collection+in+Python+-+sbozich&url=https%3A%2F%2Fsbozich.github.io%2Fposts%2Fgarbage-collection-python%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Garbage+collection+in+Python+-+sbozich&u=https%3A%2F%2Fsbozich.github.io%2Fposts%2Fgarbage-collection-python%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fsbozich.github.io%2Fposts%2Fgarbage-collection-python%2F&text=Garbage+collection+in+Python+-+sbozich" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/understanding-the-css-cascade/">Understanding the CSS Cascade&#58; How Styles are Applied in Web Development</a><li><a href="/posts/review-of-book-learn-python/">Review of the book - "A Smarter Way To Learn Python"</a><li><a href="/posts/thinkpad-x201-review/">Retro computing - review of the Lenovo Thinkpad X201</a><li><a href="/posts/hp-notebook-15-review/">HP Notebook 15 review – computing on a budget</a><li><a href="/posts/library-management-system/">C# Mini Project - Library Management System program detailed overview</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/functions/">functions</a> <a class="post-tag" href="/tags/bytecode/">bytecode</a> <a class="post-tag" href="/tags/compiler/">compiler</a> <a class="post-tag" href="/tags/databases/">databases</a> <a class="post-tag" href="/tags/interpreter/">interpreter</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/arguments/">arguments</a> <a class="post-tag" href="/tags/big-o/">big-o</a> <a class="post-tag" href="/tags/books/">books</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/missing-switch-statement/"><div class="card-body"> <em class="small" data-ts="1658181600" data-df="ll" > Jul 19, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Missing ‘switch’ Statement? Python 3.10 gets you covered</h3><div class="text-muted small"><p> Most languages support multiple flow control statements, vast majority of them is familiar with if and switch. So, someone coming from C/C++/Java/C# and alike languages might wonder about equivalen...</p></div></div></a></div><div class="card"> <a href="/posts/review-of-book-learn-python/"><div class="card-body"> <em class="small" data-ts="1677106800" data-df="ll" > Feb 23, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Review of the book - "A Smarter Way To Learn Python"</h3><div class="text-muted small"><p> If you are keen to learn programming, there are multiple learning paths available, as well as various tools that can be used in that regard. Regardless of your previous education and knowledge that...</p></div></div></a></div><div class="card"> <a href="/posts/Python's-incerement-decrement-operators/"><div class="card-body"> <em class="small" data-ts="1658440800" data-df="ll" > Jul 22, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Python’s (non-existing) increment/decrement operators</h3><div class="text-muted small"><p> Have you tried using very basic ++/– operators in Python? Incrementing/decrementing of numeric variables should be routine, right? Actually, it turns out they do not exist, and that they are not ne...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/dynamic-typing-pt2/" class="btn btn-outline-primary" prompt="Older"><p>The joys of Dynamic Typing, Part Two - Mutables</p></a> <a href="/posts/understanding-recursion-towers-hanoi/" class="btn btn-outline-primary" prompt="Newer"><p>Understanding recursion - Towers of Hanoi</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/sbozich">Sinisa Bozic</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/functions/">functions</a> <a class="post-tag" href="/tags/bytecode/">bytecode</a> <a class="post-tag" href="/tags/compiler/">compiler</a> <a class="post-tag" href="/tags/databases/">databases</a> <a class="post-tag" href="/tags/interpreter/">interpreter</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/arguments/">arguments</a> <a class="post-tag" href="/tags/big-o/">big-o</a> <a class="post-tag" href="/tags/books/">books</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
