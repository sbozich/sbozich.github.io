<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Garbage collection in Python" /><meta property="og:locale" content="en" /><meta name="description" content="When it comes to memory management, the vital task of any developer is taking care of a memory requirements of given program. This assumes allocating and dislocating the memory occupied by the variables and their data. In the early days of programming, it was a manual task so developer solely was responsible for the memory management. It was laborious job, because every single variable needed to be traced from the declaration/assignation to the point where it may be no longer needed in the code. This meant tracing variables’ attributes like scope, life and their interaction within the code, which all needed to be taken into consideration when removing it from the memory. The bugs occurred often and were sometimes hard to trace. This still stands for major languages like C/C++, although there are some add-ins that offer user-configurable memory management techniques." /><meta property="og:description" content="When it comes to memory management, the vital task of any developer is taking care of a memory requirements of given program. This assumes allocating and dislocating the memory occupied by the variables and their data. In the early days of programming, it was a manual task so developer solely was responsible for the memory management. It was laborious job, because every single variable needed to be traced from the declaration/assignation to the point where it may be no longer needed in the code. This meant tracing variables’ attributes like scope, life and their interaction within the code, which all needed to be taken into consideration when removing it from the memory. The bugs occurred often and were sometimes hard to trace. This still stands for major languages like C/C++, although there are some add-ins that offer user-configurable memory management techniques." /><link rel="canonical" href="https://sbozich.github.io/posts/garbage-collection-python/" /><meta property="og:url" content="https://sbozich.github.io/posts/garbage-collection-python/" /><meta property="og:site_name" content="sbozich" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-03T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Garbage collection in Python" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-08-03T00:00:00+02:00","datePublished":"2022-08-03T00:00:00+02:00","description":"When it comes to memory management, the vital task of any developer is taking care of a memory requirements of given program. This assumes allocating and dislocating the memory occupied by the variables and their data. In the early days of programming, it was a manual task so developer solely was responsible for the memory management. It was laborious job, because every single variable needed to be traced from the declaration/assignation to the point where it may be no longer needed in the code. This meant tracing variables’ attributes like scope, life and their interaction within the code, which all needed to be taken into consideration when removing it from the memory. The bugs occurred often and were sometimes hard to trace. This still stands for major languages like C/C++, although there are some add-ins that offer user-configurable memory management techniques.","headline":"Garbage collection in Python","mainEntityOfPage":{"@type":"WebPage","@id":"https://sbozich.github.io/posts/garbage-collection-python/"},"url":"https://sbozich.github.io/posts/garbage-collection-python/"}</script><title>Garbage collection in Python | sbozich</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=" ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://avatars.githubusercontent.com/u/92573419?s=400&u=b8588cad17faefe915dd88072a9fdd03b516d081&v=4" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">sbozich</a><p class="site-subtitle fst-italic mb-0">Bits&pieces about tech</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/sbozich" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['modblaises','proton.me'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Garbage collection in Python</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Garbage collection in Python</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1659477600" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 3, 2022 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/sbozich">Sinisa Bozic</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1713 words" > <em>9 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Garbage collection in Python</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Garbage collection in Python</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><p>When it comes to memory management, the vital task of any developer is taking care of a memory requirements of given program. This assumes allocating and dislocating the memory occupied by the variables and their data. In the early days of programming, it was a manual task so developer solely was responsible for the memory management. It was laborious job, because every single variable needed to be traced from the declaration/assignation to the point where it may be no longer needed in the code. This meant tracing variables’ attributes like scope, life and their interaction within the code, which all needed to be taken into consideration when removing it from the memory. The bugs occurred often and were sometimes hard to trace. This still stands for major languages like C/C++, although there are some add-ins that offer user-configurable memory management techniques.</p><p>Garbage collection stands for an automatized memory reclaiming process and it is a standard feature (rather than optional add-in) in the high-level languages developed in the last 30 years. This feature relieves the developer from the manual work and applies one or more algorithms, which run automatically, independently from the user. Garbage collector identifies previously allocated memory spaces (therefore called garbage) which are no more referenced by the program’s variables, and removes them, thus freeing memory.</p><h2 id="pythons-garbage-collector-specifications"><span class="me-2">Python’s garbage collector specifications</span><a href="#pythons-garbage-collector-specifications" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Python documentation <a href="https://docs.python.org/3/glossary.html#term-garbage-collection" target="_blank">states</a> following:</p><p><i>Garbage collection: The process of freeing memory when it is not used anymore. Python performs garbage collection via reference counting and a cyclic garbage collector that is able to detect and break reference cycles. The garbage collector can be controlled using the gc module.</i></p><p>From the upper definition we can see that the garbage collection in Python is twofold:</p><ol><li>Reference counting algorithm takes care of number of references that each object through its life gets. It is an integral part of the Python, it is automatic, constant process running in the background and it can’t be managed from the user side.<li>Cyclic garbage collector was added later up, when it was realized that the reference counting algorithm can’t detect some referencing cases such as reference cycles, where either object references itself or more objects are referencing each other. This garbage collector can be directly manipulated, it runs automatically periodically (but not constantly) in the background, and it can be manually switched off.</ol><h2 id="reference-counting"><span class="me-2">Reference counting</span><a href="#reference-counting" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Python is structured in a such way that it does not “hold” any data in variables but rather use them just as names which reference to the actual objects that reserve or allocate actual memory space. Every object has a header field that records actual number of references to it. For the details about this model, see following texts:</p><p><a href="https://sbozich.github.io/posts/dynamic-typing-pt1/" target="_blank">The joys of Dynamic Typing, Part One - Immutables</a></p><p><a href="https://sbozich.github.io/posts/dynamic-typing-pt2/" target="_blank">The joys of Dynamic Typing, Part Two - Mutables</a></p><p>What reference counting algorithm does is deallocates objects which loose references to the variables (more precisely, when reference count equals zero).</p><p>Consider following code:</p><h3 id="example-1"><span class="me-2">Example 1.</span><a href="#example-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">price</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">GBP</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">quantity</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">pounds</span><span class="sh">'</span><span class="p">}</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">price</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">GBP</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">quantity</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">pounds</span><span class="sh">'</span><span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span> <span class="c1"># True
</span><span class="nf">print</span><span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># False
</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># 2295298897536
</span><span class="nf">print</span><span class="p">(</span><span class="nf">id</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="c1"># 2295298897792
</span></pre></table></code></div></div><p>We created two dictionaries with the same values. Equality check expectedly returns True, because the values are the same. Identity check however prints out False, which tells us that the objects behind those two dictionaries are not the same, which is confirmed if we print out their memory addresses via id() function. Now if we display reference count of those dictionaries, we get following:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>
<span class="kn">import</span> <span class="n">sys</span>
<span class="nf">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="nf">getrefcount</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># 2
</span><span class="nf">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="nf">getrefcount</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="c1"># 2
</span></pre></table></code></div></div><p>Number of references is 2 for each object, respectively. One reference is created on assignation, another reference is created by getrefcount() function itself.</p><h3 id="example-2"><span class="me-2">Example 2.</span><a href="#example-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">sys</span>

<span class="nb">list</span><span class="o">=</span><span class="p">[]</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="nf">getrefcount</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="nf">func</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span> <span class="c1"># returns 4
</span>
<span class="nf">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="nf">getrefcount</span><span class="p">(</span><span class="nb">list</span><span class="p">))</span> <span class="c1"># returns 2
</span></pre></table></code></div></div><p>We created an empty list and defined a function which returns number of references for the passed argument. When we call the function and pass our empty list, the returned count of references is, maybe surprisingly, four:</p><ul><li>one reference for assignation of list,<li>one reference for passing an argument,<li>one reference for using function itself,<li>one reference for getrefcount() function</ul><p>On the other side, the reference count for the list itself is two:</p><ul><li>one reference for assignment,<li>one reference for getrefcount() function.</ul><h3 id="example-3"><span class="me-2">Example 3.</span><a href="#example-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">sys</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="nf">getrefcount</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># 2
</span><span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="nf">getrefcount</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># 3
</span></pre></table></code></div></div><p>By assigning an object to another object the reference count increases. To sum it up, there are four ways to increase the reference count:</p><ul><li>assignment operator,<li>argument passing,<li>calling a function or class,<li>inserting an object to another object.</ul><p>The reference count decreases when applying opposite concepts:</p><ul><li>reassigning the variable to another object,<li>deleting the variable,<li>exiting the function or class instance (Python destroys references with the variable scope local to that code block),<li>deleting an object within another object.</ul><p>There are some things to be considered though. The variable’s scope is important. If the variable has the local scope (for example, lives only in the function or class), then on exiting from the code block, Python destroys variables with local scope and thus lowers the reference count of their objects in background. Objects are destroyed only when their reference count reaches zero, not on the decrementation of the reference count! The reference count decrementation of one object that is linked to other objects is mutually linked, so when complex object like list or dictionary (containing another objects) is deleted, the reference count for all containing objects is decremented as well. If, however, another object links one or more previously deleted objects, the interpreter will take that into account and update the current reference count of such objects.</p><p>Variables outside of function/class scope that reside in the program’s “root” are global variables. Their reference count is shielded from the garbage collector as they are stored inside a dictionary and live until the termination of Python’s interpreter. The user can display global variables’ dictionary by using function globals().</p><h2 id="cyclic-garbage-collector"><span class="me-2">Cyclic garbage collector</span><a href="#cyclic-garbage-collector" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>A reference counting algorithm has one major drawback: it can’t handle reference cycles. If one variable references itself, or two or more objects are referencing each other, such situation is called a cyclic or circular reference. The reference counts stemming from cyclic references can’t be detected using reference counting algorithm, hence, additional garbage collector’s algorithm is needed to detect those and to remove them from the memory space.</p><p>If we assign a variable to itself and delete it afterwards, we can’t access the reference count as the variable is deleted:</p><h3 id="example-4"><span class="me-2">Example 4.</span><a href="#example-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">sys</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">x</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="nf">getrefcount</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># reference count=3
</span><span class="k">del</span> <span class="n">x</span>
</pre></table></code></div></div><p>Since variable x is deleted, we can’t access it using the getrefcount() function to determine what actually happened after deleting and what is the count of its references. Therefore, we must dig deeper and use code that can access memory address of the deleted object directly. In order to justify usage of another garbage collection algorithm, we need to prove that the reference count algorithm does not detect cyclic references.</p><p>Consider following situation depicted below.</p><h3 id="example-5"><span class="me-2">Example 5.</span><a href="#example-5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">gc</span>
<span class="kn">import</span> <span class="n">ctypes</span>

<span class="k">class</span> <span class="nc">PyObject</span><span class="p">(</span><span class="n">ctypes</span><span class="p">.</span><span class="n">Structure</span><span class="p">):</span>
    <span class="n">_fields_</span><span class="o">=</span><span class="p">[(</span><span class="sh">"</span><span class="s">refcount</span><span class="sh">"</span><span class="p">,</span> <span class="n">ctypes</span><span class="p">.</span><span class="n">c_long</span><span class="p">)]</span>

<span class="n">gc</span><span class="p">.</span><span class="nf">disable</span><span class="p">()</span> <span class="sh">"""</span><span class="s"> disable garbage collector to demonstrate that reference remains although we deleted variable</span><span class="sh">"""</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">x</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># x references itself
</span><span class="nf">print</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="nf">getrefcount</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># reference count=3
</span>
<span class="n">x_address</span><span class="o">=</span><span class="nf">id</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">del</span> <span class="n">x</span>

<span class="nf">print</span><span class="p">(</span><span class="n">PyObject</span><span class="p">.</span><span class="nf">from_address</span><span class="p">(</span><span class="n">x_address</span><span class="p">).</span><span class="n">refcount</span><span class="p">)</span> <span class="sh">"""</span><span class="s"> reference count=1</span><span class="sh">"""</span>

<span class="n">gc</span><span class="p">.</span><span class="nf">collect</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">PyObject</span><span class="p">.</span><span class="nf">from_address</span><span class="p">(</span><span class="n">x_address</span><span class="p">).</span><span class="n">refcount</span><span class="p">)</span> <span class="sh">"""</span><span class="s"> reference count=0 </span><span class="sh">"""</span>
</pre></table></code></div></div><p>In this example we used <a href="https://docs.python.org/3/library/ctypes.html" target="_blank">ctypes</a>, a foreign function library which enables using C data types which we will need since we’ll going to access memory addresses directly. The default cyclic garbage collector was disabled, to prevent it from eventual cleaning of the reference counts. Then we assign a memory address of variable x to another variable. Afterwards, we delete the x and print out the reference count of the object that we accessed through its memory address. Since we get one reference returned following is obvious:</p><ul><li>it is a proof that object still exists, regardless of the prior deletion of the variable x,<li>it is a proof that reference count garbage collector hasn’t detected the cyclic reference.</ul><p>When we manually start the cyclic garbage collector, we demonstrate that it works as it should because now the reference count that is returned equals zero.</p><p>As previously noted, the cyclic garbage collector runs automatically but not constantly opposed to the reference count collector, it activates itself occasionally. Another difference is that it is completely manageable and configurable, as it can be accessed within the code by using the gc module. Basically, what cyclic garbage collector does is detection of cyclic references and creation of three generations of variables which have different conditions (thresholds). We won’t go deeper in this matter here, rather we will provide some insights of how useful the understanding of the garbage collection could be.</p><h2 id="usage-tips"><span class="me-2">Usage tips</span><a href="#usage-tips" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Broadly speaking, it is best leaving all as it is, because the garbage collectors certainly justified their existence through evolutionary, incremental advancement steps during the couple of decades. They apply advanced algorithms which, on average, do satisfying job within the specified parameters. Yet, on some specific cases it is possible to tune the Python’s cyclic garbage collector, or to disable it altogether. Sometimes is favorable to avoid cyclic references completely, by using <a href="https://docs.python.org/3/library/weakref.html" target="_blank">weak references</a> instead. Another tip worth mentioning is to take a look on the global variables in the program’s code as they are untouched by the reference counting. As always, understanding the logic behind the garbage collector reveals a lot about Python’s internals and can help you to better understand the involved processes, ultimately envisioning better code for your needs.</p><h2 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This article touches upon the memory management in Python; its automation and garbage collection process. We explained the reasons behind the both implementations of garbage collector in Python, together with valid examples. Additionally, we proved why there is a need for second garbage collector, and finally gave some tips worth considering when designing your code.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/python/">python</a>, <a href="/categories/garbage-collection/">garbage collection</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/python/" class="post-tag no-text-decoration" >python</a> <a href="/tags/garbage-collection/" class="post-tag no-text-decoration" >garbage collection</a> <a href="/tags/reference-counting/" class="post-tag no-text-decoration" >reference counting</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Garbage%20collection%20in%20Python%20-%20sbozich&url=https%3A%2F%2Fsbozich.github.io%2Fposts%2Fgarbage-collection-python%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Garbage%20collection%20in%20Python%20-%20sbozich&u=https%3A%2F%2Fsbozich.github.io%2Fposts%2Fgarbage-collection-python%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fsbozich.github.io%2Fposts%2Fgarbage-collection-python%2F&text=Garbage%20collection%20in%20Python%20-%20sbozich" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/SEPA-SCT-tool/">SEPA SCT Tool v0.1 — Deterministic pain.001.001.09 CLI and Web Demo</a><li class="text-truncate lh-lg"> <a href="/posts/salary-calculator/">Introducing GrossNetto – a Free, Privacy‑First Gross↔Net Salary Calculator</a><li class="text-truncate lh-lg"> <a href="/posts/Full-Linux-Audio-Modernization-Zorin-OS-(PipeWire+Bluetooth-A2DP)/">Full Linux Audio Modernization on Zorin OS (PipeWire + Bluetooth A2DP)</a><li class="text-truncate lh-lg"> <a href="/posts/invocreator/">Introducing InvoCreator – a Free, Privacy‑First Invoice Generator</a><li class="text-truncate lh-lg"> <a href="/posts/linux-optimization-security-manual/">Linux Optimization & Security Manual (Zorin & Ubuntu-Based Systems)</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a> <a class="post-tag btn btn-outline-primary" href="/tags/functions/">functions</a> <a class="post-tag btn btn-outline-primary" href="/tags/bytecode/">bytecode</a> <a class="post-tag btn btn-outline-primary" href="/tags/compiler/">compiler</a> <a class="post-tag btn btn-outline-primary" href="/tags/databases/">databases</a> <a class="post-tag btn btn-outline-primary" href="/tags/interpreter/">interpreter</a> <a class="post-tag btn btn-outline-primary" href="/tags/algorithms/">algorithms</a> <a class="post-tag btn btn-outline-primary" href="/tags/arguments/">arguments</a> <a class="post-tag btn btn-outline-primary" href="/tags/big-o/">big-o</a> <a class="post-tag btn btn-outline-primary" href="/tags/books/">books</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/functions-scopes-python-pt2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1661983200" data-df="ll" > Sep 1, 2022 </time><h4 class="pt-0 my-2">Functions and scopes in Python, Part 2</h4><div class="text-muted"><p>The usual way to get an output from function is a return statement. As we have seen in the part 1 of this article, once the interpreter reaches the return statement, it returns the value and ends t...</p></div></div></a></article><article class="col"> <a href="/posts/Sum-intervals-codewars-challenge/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1661724000" data-df="ll" > Aug 29, 2022 </time><h4 class="pt-0 my-2">Sum of intervals Codewars challenge</h4><div class="text-muted"><p>Sum of intervals is the Codewars challenge that is about counting overlapping intervals. Let’s examine the problem’s description and see if we can devise a valid solution to it. Figure 1: Screens...</p></div></div></a></article><article class="col"> <a href="/posts/Functions-scopes-Python-pt1/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1661464800" data-df="ll" > Aug 26, 2022 </time><h4 class="pt-0 my-2">Functions and scopes in Python, Part 1</h4><div class="text-muted"><p>Functions are integral part of most programming languages. Together with classes in OOP-supported languages, they make the code more readable, concise, usable, maintainable thus greatly enhancing t...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/dynamic-typing-pt2/" class="btn btn-outline-primary" aria-label="Older" ><p>The joys of Dynamic Typing, Part Two - Mutables</p></a> <a href="/posts/understanding-recursion-towers-hanoi/" class="btn btn-outline-primary" aria-label="Newer" ><p>Understanding recursion - Towers of Hanoi</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2026</time> <a href="https://github.com/sbozich">Sinisa Bozic</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.4.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a> <a class="post-tag btn btn-outline-primary" href="/tags/functions/">functions</a> <a class="post-tag btn btn-outline-primary" href="/tags/bytecode/">bytecode</a> <a class="post-tag btn btn-outline-primary" href="/tags/compiler/">compiler</a> <a class="post-tag btn btn-outline-primary" href="/tags/databases/">databases</a> <a class="post-tag btn btn-outline-primary" href="/tags/interpreter/">interpreter</a> <a class="post-tag btn btn-outline-primary" href="/tags/algorithms/">algorithms</a> <a class="post-tag btn btn-outline-primary" href="/tags/arguments/">arguments</a> <a class="post-tag btn btn-outline-primary" href="/tags/big-o/">big-o</a> <a class="post-tag btn btn-outline-primary" href="/tags/books/">books</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
